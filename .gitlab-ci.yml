stages:
  - deploy

deploy:
  stage: deploy
  tags: ["prod"]           # <-- replace with your runner's actual tag
  rules:
    - if: '$CI_COMMIT_BRANCH == "main"'
  before_script:
    - echo "Runner: $CI_RUNNER_DESCRIPTION ($CI_RUNNER_EXECUTABLE_ARCH)"
    - docker version
    - docker compose version
    # surface envs (optional echo, but good for sanityâ€”doesn't print secrets)
    - test -n "$POSTGRES_USER" && echo "POSTGRES_USER set"
    - test -n "$POSTGRES_DB" && echo "POSTGRES_DB set"
  script:
    - echo "Deploying with compose at repo root"
    - docker compose -f compose.yaml up -d --build
